```
//@version=6
indicator('ä¹˜èˆŸæˆ˜ç¥æŒ‡æ ‡',"ä¹˜èˆŸæˆ˜ç¥æŒ‡æ ‡", overlay=true,max_labels_count = 500, max_lines_count = 500, max_boxes_count = 500)


// åˆ†ç»„
EMA_GROUP = 'EMA'
RSI_GROUP = 'RSI'
ADX_GROUP = 'ADX'
TABLE_GROUP = 'è¡¨æ ¼'
VOLUME_GROUP = 'æˆäº¤é‡ä¿¡å·'

//  ================================= EMA ==============================================

// å‚æ•°
emaShowInput = input(true,title="æ˜¾ç¤ºEMAå‡çº¿",group=EMA_GROUP)
emaShortLineInput = input.int(21,title='çŸ­æœŸå‡çº¿',group=EMA_GROUP)
emaLongLineInput = input.int(55,title='é•¿æœŸå‡çº¿',group=EMA_GROUP)

// æ‰§è¡Œ
ema_short = ta.ema(close, emaShortLineInput)
ema_long = ta.ema(close, emaLongLineInput)
plot(emaShowInput ? ema_short : na, "EMA_SHORT", color=color.new(color.blue, 0),linewidth=2,linestyle=plot.linestyle_dotted)
plot(emaShowInput ? ema_long : na, "EMA_LONG", color=color.new(color.orange, 30),linewidth=2,linestyle=plot.linestyle_dotted)

// ========================================  RSI  ==============================================

rsiLengthInput = input(14,title='RSIé•¿åº¦',group=RSI_GROUP)
rsiCandlShowInput = input(true,title='æ˜¾ç¤ºRSIèœ¡çƒ›',group=RSI_GROUP)
rsiUpColor   = input.color(color.new(color.purple, 0), "RSIèœ¡çƒ›è¶…ä¹°",group=RSI_GROUP)
rsiDownColor = input.color(color.new(color.yellow, 0), "RSIèœ¡çƒ›è¶…å–",group=RSI_GROUP)
rsiOverSoldInput = input.int(30,title='RSIè¶…ä¹°é˜ˆå€¼',group=RSI_GROUP) 
rsiOverBoughtInput = input.int(70,title='RSIè¶…å–é˜ˆå€¼',group=RSI_GROUP)
rsiDivergenceShowInput = input(true,title='æ˜¯å¦æ˜¾ç¤ºRSIèƒŒç¦»',group=RSI_GROUP)
rsiDivergenceLengthInput = input.int(25,title='RSIèƒŒç¦»çš„é•¿åº¦',group=RSI_GROUP, maxval = 500)


// === æ‰§è¡Œ ===

// RSI è¡¨æ ¼å±•ç¤º
rsiVal    = ta.rsi(close, rsiLengthInput)
rsiIsUp   = rsiVal >= rsiOverBoughtInput
rsiIsDown = rsiVal <= rsiOverSoldInput
rsiStatus = rsiIsUp ? "è¶…ä¹°" : rsiIsDown ? "è¶…å–" : "æ­£å¸¸"
rsiSymbol = rsiStatus == "è¶…ä¹°" ? "ğŸ”´" : rsiStatus == "è¶…å–" ? "ğŸŸ¢" : "âšªï¸"

// RSI è¶…ä¹°/è¶…å– èœ¡çƒ›
// åªå±•ç¤º 4å°æ—¶çº§åˆ« & æ—¥çº¿çº§åˆ«çš„è¶…å–/è¶…ä¹°,å…¶ä»–æ—¶é—´çº§åˆ«çš„ä¸é‡è¦....
barcolor((timeframe.isintraday and timeframe.multiplier == 240 and rsiCandlShowInput) or timeframe.isdaily ?
         (rsiIsUp ? rsiUpColor : rsiIsDown ? rsiDownColor : na) :
         na)

// RSI èƒŒç¦»é€»è¾‘
if rsiDivergenceShowInput
    extrapolation = 0
    // 
    xo = 0.0
    yo = 0.0
    xyo = 0.0
    xxo = 0.0
    for i = 0 to rsiDivergenceLengthInput - 1 by 1
        xo := xo + i / rsiDivergenceLengthInput
        yo := yo + rsiVal[rsiDivergenceLengthInput - 1 - i] / rsiDivergenceLengthInput
        xyo := xyo + i * rsiVal[rsiDivergenceLengthInput - 1 - i] / rsiDivergenceLengthInput
        xxo := xxo + i * i / rsiDivergenceLengthInput
        xxo
    dnm = ta.lowest(low, 200)
    dizi = array.new_float(rsiDivergenceLengthInput * 2 + 1 + extrapolation)
    linedizi = array.new_line()
    a = (xo * yo - xyo) / (xo * xo - xxo)
    b = yo - a * xo
    for i = 0 to rsiDivergenceLengthInput - 1 + extrapolation by 1
        array.set(dizi, i, a * i + b)

    // for ax+b
    mo = 0.0
    xo2 = 0.0
    yo2 = 0.0
    xyo2 = 0.0
    xxo2 = 0.0
    for i = 0 to rsiDivergenceLengthInput - 1 by 1
        mo := mo + (high[rsiDivergenceLengthInput - 1 - i]-low[rsiDivergenceLengthInput - 1 - i]) / rsiDivergenceLengthInput
        xo2 := xo2 + i / rsiDivergenceLengthInput
        yo2 := yo2 + close[rsiDivergenceLengthInput - 1 - i] / rsiDivergenceLengthInput
        xyo2 := xyo2 + i * close[rsiDivergenceLengthInput - 1 - i] / rsiDivergenceLengthInput
        xxo2 := xxo2 + i * i / rsiDivergenceLengthInput
        xxo2

    dizi2 = array.new_float(rsiDivergenceLengthInput * 2 + 1 + extrapolation)
    linedizi2 = array.new_line()
    a2 = (xo2 * yo2 - xyo2) / (xo2 * xo2 - xxo2)
    b2 = yo2 - a * xo2
    for i = 0 to rsiDivergenceLengthInput - 1 + extrapolation by 1
        array.set(dizi2, i, a2 * i + b2)
    ttk = array.get(dizi, 0) < array.get(dizi, 1) and array.get(dizi2, 0) > array.get(dizi2, 1) ? 1 : array.get(dizi, 0) > array.get(dizi, 1) and array.get(dizi2, 0) < array.get(dizi2, 1) ? -1 : 0
    cg = array.get(dizi, 0) < array.get(dizi, 1) and array.get(dizi2, 0) > array.get(dizi2, 1) 
    cr = array.get(dizi, 0) > array.get(dizi, 1) and array.get(dizi2, 0) < array.get(dizi2, 1)

    cr := cr and  array.get(dizi2, 0) - array.get(dizi2, 24) < -mo and array.get(dizi, 0) - array.get(dizi, 24) > 5
    cg := cg and array.get(dizi2, 0) - array.get(dizi2, 24) > mo and array.get(dizi, 0) - array.get(dizi, 24) < -5

    // for ax+b
    xo3 = 0.0
    yo3 = 0.0
    xyo3 = 0.0
    xxo3 = 0.0
    for i = 0 to rsiDivergenceLengthInput - 1 by 1
        xo3 := xo3 + i / rsiDivergenceLengthInput
        yo3 := yo3 + rsiVal[rsiDivergenceLengthInput - 1 - i + ta.barssince(cg)] / rsiDivergenceLengthInput
        xyo3 := xyo3 + i * rsiVal[rsiDivergenceLengthInput - 1 - i + ta.barssince(cg)] / rsiDivergenceLengthInput
        xxo3 := xxo3 + i * i / rsiDivergenceLengthInput
        xxo3

    dizi3 = array.new_float(rsiDivergenceLengthInput * 2 + 1 + extrapolation)
    linedizi3 = array.new_line()
    a3 = (xo3 * yo3 - xyo3) / (xo3 * xo3 - xxo3)
    b3 = yo3 - a3 * xo3
    for i = 0 to rsiDivergenceLengthInput - 1 + extrapolation by 1
        array.set(dizi3, i, a3 * i + b3)

    // for ax+b
    xo4 = 0.0
    yo4 = 0.0
    xyo4 = 0.0
    xxo4 = 0.0
    for i = 0 to rsiDivergenceLengthInput - 1 by 1
        xo4 := xo4 + i / rsiDivergenceLengthInput
        yo4 := yo4 + rsiVal[rsiDivergenceLengthInput - 1 - i + ta.barssince(cr)] / rsiDivergenceLengthInput
        xyo4 := xyo4 + i * rsiVal[rsiDivergenceLengthInput - 1 - i + ta.barssince(cr)] / rsiDivergenceLengthInput
        xxo4 := xxo4 + i * i / rsiDivergenceLengthInput
        xxo4

    dizi4 = array.new_float(rsiDivergenceLengthInput * 2 + 1 + extrapolation)
    linedizi4 = array.new_line()
    a4 = (xo4 * yo4 - xyo4) / (xo4 * xo4 - xxo4)
    b4 = yo4 - a4 * xo4
    for i = 0 to rsiDivergenceLengthInput - 1 + extrapolation by 1
        array.set(dizi4, i, a4 * i + b4)

    for i = 0 to rsiDivergenceLengthInput-1
        cg:= cg and not cg[i+1]
        cr:= cr and not cr[i+1]

    // for ax+b
    xo5 = 0.0
    yo5 = 0.0
    xyo5 = 0.0
    xxo5 = 0.0
    for i = 0 to rsiDivergenceLengthInput - 1 by 1
        xo5 := xo5 + i / rsiDivergenceLengthInput
        yo5 := yo5 + close[rsiDivergenceLengthInput - 1 - i + ta.barssince(cg)] / rsiDivergenceLengthInput
        xyo5 := xyo5 + i * close[rsiDivergenceLengthInput - 1 - i + ta.barssince(cg)] / rsiDivergenceLengthInput
        xxo5 := xxo5 + i * i / rsiDivergenceLengthInput
        xxo5

    dizi5 = array.new_float(rsiDivergenceLengthInput * 2 + 1 + extrapolation)
    linedizi5 = array.new_line()
    a5 = (xo5 * yo5 - xyo5) / (xo5 * xo5 - xxo5)
    b5 = yo5 - a5 * xo5
    for i = 0 to rsiDivergenceLengthInput - 1 + extrapolation by 1
        array.set(dizi5, i, a5 * i + b5)

    if cg
        line.new(ta.valuewhen(cg, bar_index, 0) - rsiDivergenceLengthInput +1, ta.valuewhen(cg, array.get(dizi5, 0), 0), ta.valuewhen(cg, bar_index, 0), ta.valuewhen(cg, array.get(dizi5, rsiDivergenceLengthInput - 1), 0), color = color.rgb(255, 0, 0), width = 1, force_overlay = true)

    // for ax+b
    xo6 = 0.0
    yo6 = 0.0
    xyo6 = 0.0
    xxo6 = 0.0
    for i = 0 to rsiDivergenceLengthInput - 1 by 1
        xo6 := xo6 + i / rsiDivergenceLengthInput
        yo6 := yo6 + close[rsiDivergenceLengthInput - 1 - i + ta.barssince(cr)] / rsiDivergenceLengthInput
        xyo6 := xyo6 + i * close[rsiDivergenceLengthInput - 1 - i + ta.barssince(cr)] / rsiDivergenceLengthInput
        xxo6 := xxo6 + i * i / rsiDivergenceLengthInput
        xxo6

    dizi6 = array.new_float(rsiDivergenceLengthInput * 2 + 1 + extrapolation)
    linedizi6 = array.new_line()
    a6 = (xo6 * yo6 - xyo6) / (xo6 * xo6 - xxo6)
    b6 = yo6 - a6 * xo6
    for i = 0 to rsiDivergenceLengthInput - 1 + extrapolation by 1
        array.set(dizi6, i, a6 * i + b6)
    if cr
        line.new(ta.valuewhen(cr, bar_index, 0) - rsiDivergenceLengthInput +1, ta.valuewhen(cr, array.get(dizi6, 0), 0), ta.valuewhen(cr, bar_index, 0), ta.valuewhen(cr, array.get(dizi6, rsiDivergenceLengthInput - 1), 0), color = color.rgb(0, 255, 0, 0), width = 1, force_overlay = true)

// ==================================  ADX ==========================================

// === è¾“å…¥å‚æ•° ===

adx_length = input.int(10, "ADXé•¿åº¦",group = ADX_GROUP)

// æ‰§è¡Œ
f_adx(len) =>
    up = ta.change(high)
    down = -ta.change(low)
    plusDM = na(up) ? na : (up > down and up > 0 ? up : 0)
    minusDM = na(down) ? na : (down > up and down > 0 ? down : 0)
    trur = ta.rma(ta.tr, len)
    plusDI = 100 * ta.rma(plusDM, len) / trur
    minusDI = 100 * ta.rma(minusDM, len) / trur
    di_sum = plusDI + minusDI
    adx_raw = di_sum == 0 ? 0 : math.abs(plusDI - minusDI) / di_sum
    adx = 100 * ta.rma(adx_raw, len)
    [adx, plusDI, minusDI]

f_adx_trend(adx, plusDI, minusDI) =>
    string symbol = "âšªï¸"
    color col = color.gray
    trend_dir = plusDI > minusDI ? "up" : "down"
    if adx < 25
        symbol := "âšªï¸"
        col := color.gray
    else if adx <= 35
        symbol := trend_dir == "up" ? "ğŸ“ˆğŸŸ¢" : "ğŸ“‰ğŸ”´"
        col := trend_dir == "up" ? color.green : color.red
    else
        symbol := trend_dir == "up" ? "ğŸ“ˆğŸ”¥" : "ğŸ“‰ğŸ”¥"
        col := trend_dir == "up" ? color.lime : color.fuchsia
    [symbol, col]

// === å½“å‰å‘¨æœŸ ADX ===
[adx_val, plusDI, minusDI] = f_adx(adx_length)
[adx_symbol, adx_color] = f_adx_trend(adx_val, plusDI, minusDI)

// === 1å°æ—¶å‘¨æœŸ ADX ===
[adx_val_1h, plusDI_1h, minusDI_1h] = request.security(syminfo.tickerid, "60", f_adx(adx_length), lookahead=barmerge.lookahead_off)
[adx_symbol_1h, adx_color_1h] = f_adx_trend(adx_val_1h, plusDI_1h, minusDI_1h)

// === 4å°æ—¶å‘¨æœŸ ADX ===
[adx_val_4h, plusDI_4h, minusDI_4h] = request.security(syminfo.tickerid, "240", f_adx(adx_length), lookahead=barmerge.lookahead_off)
[adx_symbol_4h, adx_color_4h] = f_adx_trend(adx_val_4h, plusDI_4h, minusDI_4h)



// ==================================  æˆäº¤é‡ ==========================================

volumeLengthInput = input.int(20,title='å¹³å‡æˆäº¤é‡é•¿åº¦',group=VOLUME_GROUP)
mildVolumeInput = input.float(1.2,title='æ™®é€šçˆ†é‡å€æ•°',group=VOLUME_GROUP)
strongVolumeInput = input.float(1.5,title='ä¸­çº§çˆ†é‡å€æ•°',group=VOLUME_GROUP)
extremeVolumeInput = input.float(2,title='é«˜çº§çˆ†é‡å€æ•°',group=VOLUME_GROUP)
buyShowInput = input(true,title='æ˜¾ç¤ºbuyä¿¡å·',group=VOLUME_GROUP)
buyBreakInput = input.int(20,title='æœ€é«˜/æœ€ä½ä»·æ ¼èŒƒå›´',group=VOLUME_GROUP)
buyWatchInput = input.int(5,title='ä¹°å…¥ç›‘æ§çš„Kçº¿æ€»æ•°',group=VOLUME_GROUP)
sellWatchInput = input.int(3,title='å–å‡ºç›‘æ§çš„Kçº¿æ€»æ•°',group=VOLUME_GROUP)
buyVolumeInput = input.float(1,title='è·Ÿéšæˆäº¤é‡å€æ•°',group=VOLUME_GROUP)
buyRequiredInput = input.int(2,title='ä¹°å…¥è·ŸéšKçº¿æ€»æ•°',group=VOLUME_GROUP)
sellRequiredInput = input.int(1,title='å–å‡ºè·ŸéšKçº¿æ€»æ•°',group=VOLUME_GROUP)
springShowInput = input(true,title='æ˜¾ç¤ºå¤šç©ºä¿¡å·',group=VOLUME_GROUP)
springLengthInput = input.int(50,title='æœ€é«˜/æœ€ä½ä»·æ ¼èŒƒå›´',group=VOLUME_GROUP)


// ================================== BUYé€»è¾‘ ============================================

vol_ma = ta.sma(volume, volumeLengthInput)
vol_mild    = volume > vol_ma * mildVolumeInput and volume <= vol_ma * strongVolumeInput
vol_strong  = volume > vol_ma * strongVolumeInput and volume <= vol_ma * extremeVolumeInput
vol_extreme = volume > vol_ma * extremeVolumeInput


// === çŠ¶æ€å˜é‡ ===

// ä¹°å…¥çŠ¶æ€
var bool track_follow = false        // æ˜¯å¦æ­£åœ¨è·Ÿè¸ªä¸­
var int bars_since_break = 0         // å·²ç»è¿‡å»çš„Kçº¿æ•°
var int follow_vol_count = 0         // è·Ÿéšæ”¾é‡çš„æ•°é‡
var bool has_following_vol = false   // æ˜¯å¦ç¡®è®¤å‡ºç°è·Ÿéšæ”¾é‡
var label buy_label = na  // ä¿å­˜æ ‡ç­¾ï¼Œé˜²æ­¢é‡å¤ç”»

// å–å‡ºçŠ¶æ€
var bool track_follow_sell = false 
var int bars_since_break_sell = 0
var int follow_vol_count_sell = 0
var bool has_following_vol_sell = false
var label sell_label = na

// ä¿¡å·ä½ç½®

atr30 = ta.atr(30)
y1 = low - (atr30 * 2.0)


//    ==== æ¡ä»¶ ====

// Buyæ¡ä»¶
bull_anchor_low = ta.lowest(low, buyBreakInput)
is_bull_anchor_break = low == bull_anchor_low 
// çˆ†é‡Kçš„æ¡ä»¶: æˆäº¤é‡1.2, åˆ›é€ äº†æœ€ä½ç‚¹,é˜³K
is_main_break = volume >= vol_ma * mildVolumeInput and is_bull_anchor_break and close > open

// SELLæ¡ä»¶
bear_anchor_high = ta.highest(high,buyBreakInput)
is_bear_anchor_break = high == bear_anchor_high 
is_main_break_sell = volume >= vol_ma * mildVolumeInput and is_bear_anchor_break and close < open

// æ—¶é—´æ¡ä»¶
is_lower_than_4h = timeframe.in_seconds(timeframe.period) < timeframe.in_seconds("240")
is_1h_or_higher = timeframe.in_seconds(timeframe.period) >= timeframe.in_seconds("60")

//  ====== ä¸»é€»è¾‘ =======

if buyShowInput and is_lower_than_4h
    // ä¹°å…¥è·Ÿéš
    if is_main_break and not track_follow
        // å‡å¦‚å·²ç»å‡ºç°äº†çˆ†é‡Kï¼Œå¹¶ä¸”æœªå¯åŠ¨ç›‘æ§ï¼Œåˆ™å¯åŠ¨ç›‘æ§ï¼Œå¹¶æ¢å¤åˆå§‹è®¡æ—¶
        track_follow := true
        bars_since_break := 0
        follow_vol_count := 0
        has_following_vol := false
        box.new(bar_index, high, bar_index + buyWatchInput, low, bgcolor=color.new(color.green,80), border_color=color.green)
    // çˆ†é‡å·²ç»å‡ºç°å¹¶ä¸”å¯åŠ¨äº†ç›‘æ§äº†
    else if track_follow
         // è¿›å…¥è·Ÿè¸ªé€»è¾‘
        bars_since_break += 1
        // æ£€æŸ¥å½“å‰Kçº¿æ˜¯å¦æ”¾é‡ä¸”ä¸Šæ¶¨,æ”¾é‡åè¿›è¡Œç´¯åŠ 
        if volume > vol_ma * buyVolumeInput and close > open // å¿…é¡»ä¿è¯æ˜¯é˜³çº¿è·Ÿéš
            follow_vol_count += 1
        // è‹¥5æ ¹å†…å‡ºç°è‡³å°‘2æ ¹æ”¾é‡ï¼Œåˆ™ç¡®è®¤æˆåŠŸ
        if follow_vol_count >= buyRequiredInput and not has_following_vol
            has_following_vol := true // å±•ç¤ºè¿ç»­æ”¾é‡æ ‡ç­¾
            buy_label := label.new(bar_index, low - atr30*2, "BUY\nâ˜…", style=label.style_label_up,color=color.new(color.green,0),textcolor=color.white,size=size.small)
        // è¶…è¿‡5æ ¹å–æ¶ˆç›‘æ§å¹¶å»é™¤æ ‡ç­¾
        if bars_since_break >= buyWatchInput
            track_follow := false // æ”¾å¼ƒç»Ÿè®¡å¹¶é‡æ–°è¿›è¡Œçˆ†é‡Kçš„ç»Ÿè®¡
            has_following_vol := false  // å»é™¤æ ‡ç­¾çš„å±•ç¤º
    // å–å‡ºè·Ÿéš
    if is_main_break_sell
        track_follow_sell := true
        bars_since_break_sell := 0
        follow_vol_count_sell := 0
        has_following_vol_sell := false
        box.new(bar_index, high, bar_index + sellWatchInput, low, bgcolor=color.new(color.red,80), border_color=color.red)
    else if track_follow_sell
        bars_since_break_sell += 1
        // å¿…é¡»æ˜¯é˜´çº¿è·Ÿéš
        if volume > vol_ma * buyVolumeInput and close < open
            follow_vol_count_sell += 1
        if follow_vol_count_sell >= sellRequiredInput and not has_following_vol_sell
            has_following_vol_sell := true
            sell_label := label.new(bar_index, high + atr30*2, "SELL\nâ˜…", style=label.style_label_down,color=color.new(color.red,0),textcolor=color.white,size=size.small)
        // è¶…è¿‡5æ ¹å–æ¶ˆç›‘æ§å¹¶å»é™¤æ ‡ç­¾
        if bars_since_break_sell >= sellWatchInput
            track_follow_sell := false
            has_following_vol_sell := false        
// === å¯è§†åŒ–æ ‡è¯† ===
vol_symbol =
     vol_extreme       ? "ğŸš€" :
     vol_strong        ? "ğŸ’¥" :
     vol_mild          ? "ğŸŸ¢" :
                         "âšªï¸"


// =============================  Spring å¤šé€»è¾‘ ============================

prev_low = ta.lowest(low, springLengthInput)[1] // 50æ ¹Kçº¿çš„æœ€ä½ç‚¹,ä¸åŒ…å«å½“å‰K
// å‰ä¸€æ ¹é˜´çº¿åˆ¤æ–­
prev_is_bear = close[1] < open[1]
prev_bear_body = prev_is_bear ? open[1] - close[1] : na 
// å½“å‰é˜³çº¿åˆ¤æ–­
curr_is_bull = close > open 
curr_bull_body = curr_is_bull ? close - open : na 
// é˜³çº¿å¼ºåº¦ + ä¸Šå½±çº¿è¿‡æ»¤
bull_strong_enough = prev_is_bear and curr_is_bull and curr_bull_body >= prev_bear_body * 0.5
upper_wick = curr_is_bull ? high - close : 0
// ä¸å…è®¸ä¸Šå½±çº¿å¤§äºå®ä½“çš„1.2å€,å¯ä»¥ä¸€æ ·é•¿,ä½†æ˜¯ä¸èƒ½è¿‡é•¿
upper_wick_ok = curr_is_bull and upper_wick <= curr_bull_body * 1.2
spring_low_signal = prev_is_bear and curr_is_bull and low[1] == prev_low and close > low[1] and bull_strong_enough and upper_wick_ok
// é‡èƒ½è¦æ±‚
stars_low =
     volume[1] >= vol_ma * 1.5 and volume >= vol_ma * 1.5 ? "â­â­â­" :
     volume[1] >= vol_ma * 1.2 and volume >= vol_ma * 1.2 ? "â­â­"  :
     volume[1] >= vol_ma * 1   and volume >= vol_ma * 1   ? "â­"   :
     ""
// ä¸€æ˜Ÿ
plotshape(
    springShowInput and is_1h_or_higher and  spring_low_signal and stars_low == "â­",
    style = shape.labelup,
    location = location.belowbar,
    color = color.green,
    text = "å¤š",  // const string
    textcolor = color.white,
    size = size.tiny
)

// äºŒæ˜Ÿ
plotshape(
    springShowInput and is_1h_or_higher and spring_low_signal and stars_low == "â­â­",
    style = shape.labelup,
    location = location.belowbar,
    color = color.green,
    text = "å¼ºå¤š",
    textcolor = color.white,
    size = size.tiny
)

// ä¸‰æ˜Ÿ
plotshape(
    springShowInput and is_1h_or_higher and spring_low_signal and stars_low == "â­â­â­",
    style = shape.labelup,
    location = location.belowbar,
    color = color.green,
    text = "æš´å¤š",
    textcolor = color.white,
    size = size.tiny
)


// ==================== spring ç©ºé€»è¾‘ =============================== 

// å‰50æ ¹Kçº¿çš„æœ€é«˜ç‚¹ï¼ˆä¸åŒ…å«å½“å‰Kï¼‰
prev_high = ta.highest(high, springLengthInput)[1]

// å‰ä¸€æ ¹é˜³çº¿åˆ¤æ–­
prev_is_bull = close[1] > open[1]
prev_bull_body = prev_is_bull ? close[1] - open[1] : na 
// å½“å‰é˜´çº¿åˆ¤æ–­
curr_is_bear = close < open
curr_bear_body = curr_is_bear ? open - close : na

// é˜´çº¿å¼ºåº¦åˆ¤æ–­(å®ä½“ä¸èƒ½å¤ªå°)
bear_strong_enough = prev_is_bull and curr_is_bear and curr_bear_body >= prev_bull_body * 0.5

// ä¿¡å·
spring_high_signal = prev_is_bull and curr_is_bear and high[1] == prev_high and close < high[1] and bear_strong_enough

// é‡èƒ½æ˜Ÿçº§
stars_high =
     volume[1] >= vol_ma * 1.5 and volume >= vol_ma * 1.5 ? "â­â­â­" :
     volume[1] >= vol_ma * 1.2 and volume >= vol_ma * 1.2 ? "â­â­"  :
     volume[1] >= vol_ma * 1   and volume >= vol_ma * 1   ? "â­"   :
     ""

// ä¸€æ˜Ÿï¼ˆç©ºï¼‰
plotshape(
    springShowInput and is_1h_or_higher and spring_high_signal and stars_high == "â­",
    style = shape.labeldown,
    location = location.abovebar,
    color = color.red,
    text = "ç©º",
    textcolor = color.white,
    size = size.tiny
)

// äºŒæ˜Ÿï¼ˆå¼ºç©ºï¼‰
plotshape(
    springShowInput and is_1h_or_higher and spring_high_signal and stars_high == "â­â­",
    style = shape.labeldown,
    location = location.abovebar,
    color = color.red,
    text = "å¼ºç©º",
    textcolor = color.white,
    size = size.tiny
)

// ä¸‰æ˜Ÿï¼ˆæš´ç©ºï¼‰
plotshape(
    springShowInput and is_1h_or_higher and spring_high_signal and stars_high == "â­â­â­",
    style = shape.labeldown,
    location = location.abovebar,
    color = color.red,
    text = "æš´ç©º",
    textcolor = color.white,
    size = size.tiny
)


// ============================================== ä¿¡æ¯è¡¨æ ¼å±•ç¤º ==================================================

tableShowInput = input(true,title='æ˜¯å¦å±•ç¤ºè¡¨æ ¼',group=TABLE_GROUP)
if tableShowInput
    var table info_table = table.new(position.top_right, 2, 10, border_width=1)

    table.cell(info_table, 0, 0, "Indicator", text_color=color.white, bgcolor=color.gray)
    table.cell(info_table, 1, 0, "Value", text_color=color.white, bgcolor=color.gray)

    table.cell(info_table, 0, 1, "RSI", text_color=color.white, bgcolor=color.gray)
    table.cell(info_table, 1, 1, rsiSymbol + "  " + str.tostring(rsiVal, "#.##"), text_color=color.white, bgcolor=color.new(color.black, 50))


    table.cell(info_table, 0, 3, "Volume", text_color=color.white, bgcolor=color.gray)
    table.cell(info_table, 1, 3, vol_symbol, text_color=color.white, bgcolor=color.new(color.black, 50))

    string cont_vol_str = has_following_vol ? "ğŸ”¥ğŸ”¥ğŸ”¥" : ""
    table.cell(info_table, 0, 4, "Volume++", text_color=color.white, bgcolor=color.gray)
    table.cell(info_table, 1, 4, cont_vol_str, text_color=color.white, bgcolor=color.new(color.black, 50))

    table.cell(info_table, 0, 5, "ADX", text_color=color.white, bgcolor=color.gray)
    table.cell(info_table, 1, 5, adx_symbol + "  " + str.tostring(adx_val, "#.##"), text_color=color.white, bgcolor=color.new(adx_color, 70))

    table.cell(info_table, 0, 6, "1H ADX", text_color=color.white, bgcolor=color.gray)
    table.cell(info_table, 1, 6, adx_symbol_1h + "  " + str.tostring(adx_val_1h, "#.##"), text_color=color.white, bgcolor=color.new(adx_color_1h, 70))

    table.cell(info_table, 0, 7, "4H ADX", text_color=color.white, bgcolor=color.gray)
    table.cell(info_table, 1, 7, adx_symbol_4h + "  " + str.tostring(adx_val_4h, "#.##"), text_color=color.white, bgcolor=color.new(adx_color_4h, 70))

```